<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reset Password - PixelRefine AI</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <style>
    /* Same CSS as above */
    :root { --primary: #8b5cf6; --dark: #1e293b; --darker: #0f172a; --light: #f8fafc; --light-gray: #e2e8f0; --border: #334155; --success: #10b981; --error: #ef4444; }
    body { background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%); font-family: 'Inter', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; color: var(--light); }
    .container { width: 100%; max-width: 450px; padding: 0 1.5rem; }
    .auth-container { background: rgba(30, 41, 59, 0.8); padding: 2.5rem; border-radius: 1rem; width: 100%; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
    .logo { display: flex; align-items: center; gap: 0.75rem; justify-content: center; margin-bottom: 2rem; text-decoration: none; }
    .logo-icon { width: 32px; height: 32px; background: linear-gradient(135deg, var(--primary), #3b82f6); border-radius: 8px; display: flex; align-items: center; justify-content: center; }
    .logo-text { font-size: 1.5rem; font-weight: 700; background: linear-gradient(135deg, var(--primary), #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .form-group { margin-bottom: 1.25rem; }
    .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
    .form-control { width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid var(--border); background: #1e293b; color: white; font-size: 1rem; transition: all 0.3s ease; }
    .form-control:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3); }
    .btn { width: 100%; padding: 0.75rem; border: none; border-radius: 0.5rem; background: linear-gradient(135deg, var(--primary), #3b82f6); color: white; font-weight: 600; cursor: pointer; margin-top: 1rem; font-size: 1rem; transition: all 0.3s ease; }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
    .auth-link { display: block; text-align: center; margin-top: 1.5rem; color: var(--primary); text-decoration: none; }
    .auth-link:hover { text-decoration: underline; }
    .alert { padding: 0.75rem; margin-bottom: 1rem; border-radius: 0.5rem; border-left: 4px solid var(--error); background: rgba(239, 68, 68, 0.1); color: var(--light); }
    .alert-success { border-left-color: var(--success); background: rgba(16, 185, 129, 0.1); }
    .back-home { text-align: center; margin-top: 2rem; }
    .back-home a { color: var(--light-gray); text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; transition: color 0.3s ease; }
    .back-home a:hover { color: var(--primary); }
    .instructions { color: var(--light-gray); font-size: 0.9rem; margin-bottom: 1.5rem; text-align: center; line-height: 1.5; }
    .password-requirement { font-size: 0.8rem; color: var(--light-gray); margin-top: 0.25rem; }
  </style>
</head>
<body>
  <div class="container">
    <a href="index.html" class="logo">
      <div class="logo-icon">
        <i class="fas fa-bolt"></i>
      </div>
      <span class="logo-text">PixelRefine AI</span>
    </a>

    <div class="auth-container">
      <h2 style="text-align: center; margin-bottom: 0.5rem;">Create New Password</h2>
      <p class="instructions">
        Enter your new password below. Make sure it's at least 6 characters long.
      </p>
      
      <form id="resetPasswordForm">
        <div class="form-group">
          <label for="password">New Password</label>
          <input type="password" id="password" name="password" class="form-control" placeholder="Enter new password" required minlength="6">
          <p class="password-requirement">Must be at least 6 characters</p>
        </div>
        
        <div class="form-group">
          <label for="confirmPassword">Confirm New Password</label>
          <input type="password" id="confirmPassword" name="confirmPassword" class="form-control" placeholder="Confirm new password" required minlength="6">
        </div>
        
        <button type="submit" class="btn" id="submitBtn">
          <i class="fas fa-save"></i> Reset Password
        </button>
      </form>
      
      <div style="text-align: center; margin-top: 1.5rem;">
        <a href="signin.html" class="auth-link">
          <i class="fas fa-arrow-left"></i> Back to Sign In
        </a>
      </div>
    </div>

    <div class="back-home">
      <a href="index.html">
        <i class="fas fa-home"></i> Back to Home
      </a>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDMWaj1ZuGGYj3l1-KOHCBvMbRk3cX2isg",
      authDomain: "pixelrefine-ai.firebaseapp.com",
      projectId: "pixelrefine-ai",
      storageBucket: "pixelrefine-ai.firebasestorage.app",
      messagingSenderId: "227630158334",
      appId: "1:227630158334:web:5e5bd6c6e2ec31aaa770af"
    };
    firebase.initializeApp(firebaseConfig);

    const urlParams = new URLSearchParams(window.location.search);
    const oobCode = urlParams.get('oobCode'); // Firebase uses oobCode, not "token"

    if (!oobCode) {
      alert('Invalid or expired reset link.');
      window.location.href = 'forgot-password.html';
    }

    document.getElementById('resetPasswordForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const submitBtn = document.getElementById('submitBtn');

      if (!password || !confirmPassword) {
        showAlert('Please fill in all fields', 'error');
        return;
      }
      if (password.length < 6) {
        showAlert('Password must be at least 6 characters long', 'error');
        return;
      }
      if (password !== confirmPassword) {
        showAlert('Passwords do not match', 'error');
        return;
      }

      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Resetting...';
      submitBtn.disabled = true;

      try {
        await firebase.auth().confirmPasswordReset(oobCode, password);
        showAlert('Password has been reset! Redirecting to login...', 'success');
        setTimeout(() => {
          window.location.href = 'signin.html';
        }, 3000);
      } catch (error) {
        console.error('Reset error:', error);
        showAlert(error.message || 'Failed to reset password', 'error');
      } finally {
        submitBtn.innerHTML = '<i class="fas fa-save"></i> Reset Password';
        submitBtn.disabled = false;
      }
    });

    function showAlert(message, type) {
      const existingAlert = document.querySelector('.alert');
      if (existingAlert) existingAlert.remove();

      const alert = document.createElement('div');
      alert.className = `alert ${type === 'success' ? 'alert-success' : ''}`;
      alert.innerHTML = `
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
          <span>${message}</span>
        </div>
      `;
      document.querySelector('.auth-container').insertBefore(alert, document.querySelector('#resetPasswordForm'));
    }

    // Auto-check on load
    window.addEventListener('load', () => {
      if (!oobCode) {
        showAlert('Invalid reset link. Please request a new password reset.', 'error');
      }
    });
  </script>
</body>
</html>